<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FastCripto - Conversão de Criptomoedas</title>

    <!-- Estilos -->
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="stylesheet" href="assets/css/responsive.css" />

    <!-- Ícones -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <!-- Detecção de ambiente -->
    <script>
      // Determine qual arquivo de configuração carregar com base no ambiente
      (function () {
        const hostname = window.location.hostname;
        let environment = 'development';

        if (hostname.includes('test') || hostname.includes('staging')) {
          environment = 'test';
        } else if (
          !hostname.includes('localhost') &&
          !hostname.includes('127.0.0.1')
        ) {
          environment = 'production';
        }

        console.log(`Ambiente detectado: ${environment}`);
        window.__ENV__ = environment;
      })();
    </script>

    <!-- Módulos JavaScript (usando type="module" para suporte a imports ES6) -->
    <script type="module" src="assets/js/main.js"></script>
  </head>
  <body>
    <!-- Cabeçalho -->
    <header>
      <div class="container header-content">
        <div class="logo">
          <i class="bi bi-currency-bitcoin logo-icon"></i>
          FastCripto
        </div>

        <nav>
          <ul>
            <li>
              <a href="#" class="tab-nav active" data-tab="converter"
                >Converter</a
              >
            </li>
            <li>
              <a href="#" class="tab-nav" data-tab="transactions">Transações</a>
            </li>
            <li><a href="#" class="tab-nav" data-tab="account">Conta</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- Adicionar depois do header, antes do conteúdo principal -->
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="alert alert-warning" style="background-color: #fff7ed; border-radius: 12px; border: none; box-shadow: var(--card-shadow); padding: 20px; border-left: 5px solid #f59e0b;">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 style="font-weight: 600; color: #c2410c; margin-bottom: 8px;"><i class="bi bi-exclamation-triangle-fill me-2"></i>Verificação KYC Necessária</h5>
                            <p class="mb-0" style="color: #9a3412;">Verifique sua identidade para aumentar seus limites de transação</p>
                        </div>
                        <button id="mainKycBtn" class="btn primary" 
                                style="padding: 12px 24px; font-weight: 600; font-size: 16px; box-shadow: 0 8px 15px rgba(93, 95, 239, 0.3); min-width: 240px;">
                            <i class="bi bi-shield-check me-2"></i>Fazer Verificação KYC
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <main>
      <div class="container">
        <!-- Aba do Conversor -->
        <section id="converter" class="tab-content active">
          <h1>Converter Reais para Criptomoedas</h1>
          <p class="subtitle">
            Calcule o valor final de sua compra com todas as taxas inclusas
          </p>

          <!-- Cotações atuais -->
          <div class="rates-grid">
            <div class="rate-card">
              <div class="rate-icon">
                <i class="bi bi-currency-bitcoin"></i>
              </div>
              <div class="rate-info">
                <h3>Bitcoin</h3>
                <div class="rate-value" id="btc-rate">Carregando...</div>
              </div>
            </div>

            <div class="rate-card">
              <div class="rate-icon">
                <i class="bi bi-diagram-3"></i>
              </div>
              <div class="rate-info">
                <h3>Ethereum</h3>
                <div class="rate-value" id="eth-rate">Carregando...</div>
              </div>
            </div>

            <div class="rate-card">
              <div class="rate-icon">
                <i class="bi bi-cash-coin"></i>
              </div>
              <div class="rate-info">
                <h3>USDT</h3>
                <div class="rate-value" id="usdt-rate">Carregando...</div>
              </div>
            </div>
          </div>

          <div class="update-info">
            <span id="last-update-time"
              >Última atualização: --/--/---- --:--</span
            >
            <button id="manual-refresh" class="btn small">
              <i class="bi bi-arrow-clockwise"></i> Atualizar
            </button>
            <div id="rates-loader" class="rates-loader"></div>
          </div>

          <!-- Navegação de etapas -->
          <div class="conversion-steps">
            <div class="step active" data-step="valor-moeda">1. Valor e Moeda</div>
            <div class="step" data-step="revisao">2. Revisão</div>
            <div class="step" data-step="pagamento">3. Pagamento</div>
          </div>

          <!-- Container de subabas -->
          <div class="converter-steps-container">
            <!-- Etapa 1: Valor e Moeda -->
            <div id="step-valor-moeda" class="conversion-step active">
              <div class="conversion-card">
                <form id="conversion-form">
                  <div class="form-group">
                    <label for="brl-amount">Valor em Reais (R$)</label>
                    <input
                      type="number"
                      id="brl-amount"
                      min="100"
                      step="10"
                      placeholder="0,00"
                    />
                    <small>Valor mínimo: R$ 100,00</small>
                  </div>

                  <div class="form-group">
                    <label>Criptomoeda</label>
                    <div class="crypto-options">
                      <label class="crypto-option">
                        <input
                          type="radio"
                          name="crypto-currency"
                          value="BTC"
                        />
                        <div class="crypto-icon">
                          <i class="bi bi-currency-bitcoin"></i>
                        </div>
                        <div class="crypto-name">Bitcoin</div>
                        <div class="crypto-ticker">BTC</div>
                      </label>

                      <label class="crypto-option">
                        <input type="radio" name="crypto-currency" value="ETH" />
                        <div class="crypto-icon">
                          <i class="bi bi-diagram-3"></i>
                        </div>
                        <div class="crypto-name">Ethereum</div>
                        <div class="crypto-ticker">ETH</div>
                      </label>

                      <label class="crypto-option">
                        <input type="radio" name="crypto-currency" value="USDT" checked />
                        <div class="crypto-icon">
                          <i class="bi bi-cash-coin"></i>
                        </div>
                        <div class="crypto-name">Tether</div>
                        <div class="crypto-ticker">USDT</div>
                      </label>
                    </div>
                    
                    <div class="alert alert-info mt-3" style="font-size: 0.9rem; padding: 10px; border-radius: 6px; background-color: #e7f5ff; border-left: 4px solid #4c6ef5;">
                      <i class="bi bi-info-circle-fill me-2"></i>
                      <strong>USDT:</strong> Utilizamos a rede TRON (TRC20) para transações USDT por sua velocidade e baixo custo.
                    </div>
                  </div>

                  <div class="form-actions">
                    <button type="button" id="btn-calculate" class="btn primary">
                      Calcular e Prosseguir
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Etapa 2: Revisão -->
            <div id="step-revisao" class="conversion-step">
              <div class="conversion-card">
                <!-- Resultado da conversão -->
                <div id="conversion-result" class="conversion-result">
                  <h3>Resultado da Conversão</h3>

                  <div class="result-row">
                    <div class="result-label">Valor em Reais:</div>
                    <div class="result-value" id="result-brl-amount">R$ 0,00</div>
                  </div>

                  <div class="result-row">
                    <div class="result-label">IOF (0,38%):</div>
                    <div class="result-value" id="result-iof">- R$ 0,00</div>
                  </div>

                  <div class="result-row">
                    <div class="result-label">Taxa de Serviço (6%):</div>
                    <div class="result-value" id="result-service-fee">
                      - R$ 0,00
                    </div>
                  </div>

                  <div class="result-row">
                    <div class="result-label">Taxa da Rede:</div>
                    <div class="result-value" id="result-network-fee">- 0.00</div>
                  </div>

                  <div class="result-row total">
                    <div class="result-label">Valor Líquido:</div>
                    <div class="result-value" id="result-net-amount">R$ 0,00</div>
                  </div>

                  <div class="result-row rate-info">
                    <div class="result-label">Cotação Utilizada:</div>
                    <div class="result-value" id="result-rate">R$ 0,00</div>
                  </div>

                  <div class="result-row crypto-result">
                    <div class="result-label">Valor Final em Cripto:</div>
                    <div class="result-value" id="result-crypto-amount">
                      0.00000000 BTC
                    </div>
                  </div>
                </div>

                <div class="form-actions d-flex justify-content-between">
                  <button type="button" id="btn-back-to-step1" class="btn secondary">
                    <i class="bi bi-arrow-left"></i> Voltar
                  </button>
                  <button type="button" id="btn-proceed-to-step3" class="btn primary">
                    Prosseguir <i class="bi bi-arrow-right"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Etapa 3: Pagamento/Endereço -->
            <div id="step-pagamento" class="conversion-step">
              <div class="conversion-card">
                <h3><i class="bi bi-wallet2"></i> Informações da Carteira</h3>
                <p>Informe a rede e o endereço da sua carteira para receber os valores.</p>

                <form id="wallet-form">
                  <div class="form-group">
                    <label>Rede Blockchain</label>
                    <div class="network-options" style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 10px;">
                      <label class="network-option" style="display: flex; align-items: center; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; min-width: 120px;">
                        <input
                          type="radio"
                          name="network"
                          value="BTC"
                          class="network-btc"
                          checked
                          style="margin-right: 10px;"
                        />
                        <span style="font-weight: 500;"><i class="bi bi-currency-bitcoin" style="color: #f7931a; margin-right: 5px;"></i>Bitcoin</span>
                      </label>

                      <label class="network-option" style="display: flex; align-items: center; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; min-width: 120px;">
                        <input
                          type="radio"
                          name="network"
                          value="ETH"
                          class="network-eth"
                          style="margin-right: 10px;"
                        />
                        <span style="font-weight: 500;"><i class="bi bi-currency-exchange" style="color: #627eea; margin-right: 5px;"></i>Ethereum</span>
                      </label>

                      <label class="network-option" style="display: flex; align-items: center; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; min-width: 120px;">
                        <input
                          type="radio"
                          name="network"
                          value="BSC"
                          class="network-bsc"
                          style="margin-right: 10px;"
                        />
                        <span style="font-weight: 500;"><i class="bi bi-grid" style="color: #f3ba2f; margin-right: 5px;"></i>BSC</span>
                      </label>

                      <label class="network-option" style="display: flex; align-items: center; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; min-width: 120px;">
                        <input
                          type="radio"
                          name="network"
                          value="TRON"
                          class="network-tron"
                          style="margin-right: 10px;"
                        />
                        <span style="font-weight: 500;"><i class="bi bi-heptagon" style="color: #ff060a; margin-right: 5px;"></i>TRON</span>
                      </label>
                    </div>
                  </div>

                  <div class="form-group" style="margin-top: 25px;">
                    <label for="wallet-address" style="display: block; margin-bottom: 10px; font-weight: 600;">
                      <i class="bi bi-shield-check" style="color: #4c6ef5; margin-right: 5px;"></i>Endereço da Carteira
                    </label>
                    <div style="position: relative;">
                      <input
                        type="text"
                        id="wallet-address"
                        placeholder="Endereço da sua carteira de criptomoedas"
                        style="width: 100%; padding: 15px; border: 2px solid #ced4da; border-radius: 8px; font-size: 16px; font-family: monospace; transition: all 0.3s ease;"
                      />
                      <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); display: flex; gap: 10px;">
                        <button type="button" style="background: none; border: none; color: #4c6ef5; cursor: pointer; font-size: 18px;" title="Colar da área de transferência">
                          <i class="bi bi-clipboard"></i>
                        </button>
                        <button type="button" style="background: none; border: none; color: #4c6ef5; cursor: pointer; font-size: 18px;" title="Verificar endereço">
                          <i class="bi bi-check-circle"></i>
                        </button>
                      </div>
                    </div>
                    <div id="wallet-address-warning" style="display: none; margin-top: 10px; font-size: 14px;">
                      <i class="bi bi-exclamation-triangle"></i>
                      Verifique com atenção o endereço da carteira. Transações enviadas para endereços incorretos não podem ser recuperadas.
                    </div>
                  </div>

                  <div class="form-check mb-3" style="margin-top: 20px; background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #4c6ef5;">
                    <input class="form-check-input" type="checkbox" id="wallet-confirm" required style="width: 18px; height: 18px; margin-right: 10px;">
                    <label class="form-check-label" for="wallet-confirm" style="font-weight: 500;">
                      <strong>Confirmo que o endereço está correto e pertence a mim.</strong><br>
                      <small style="color: #6c757d;">Transações em blockchain são irreversíveis. Verifique com cuidado.</small>
                    </label>
                  </div>

                  <div class="form-actions d-flex justify-content-between" style="margin-top: 30px;">
                    <button type="button" id="btn-back-to-step2" class="btn secondary" style="padding: 12px 20px; border-radius: 8px; display: flex; align-items: center; gap: 8px;">
                      <i class="bi bi-arrow-left"></i> Voltar
                    </button>
                    <button type="submit" id="btn-complete-transaction" class="btn primary" style="padding: 15px 30px; border-radius: 8px; font-weight: 600; font-size: 16px; box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11); display: flex; align-items: center; gap: 8px;">
                      <i class="bi bi-check-circle"></i> Completar Transação
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </section>

        <!-- Aba de Transações -->
        <section id="transactions" class="tab-content">
          <h1>Minhas Transações</h1>
          <p class="subtitle">
            Acompanhe o status de suas conversões de criptomoedas
          </p>

          <!-- Estado vazio (quando não há transações) -->
          <div id="transactions-empty" class="empty-state">
            <i class="bi bi-inbox-fill"></i>
            <h3>Nenhuma transação encontrada</h3>
            <p>Suas transações aparecerão aqui após completar uma conversão.</p>
            <button id="btn-new-transaction" class="btn primary">
              Iniciar Nova Transação
            </button>
          </div>

          <!-- Lista de transações -->
          <div id="transactions-list" class="transactions-list">
            <!-- As transações serão inseridas aqui dinamicamente -->
          </div>

          <!-- Estado KYC Pendente -->
          <div id="kyc-pending" class="account-card" style="display: none">
            <h3>Verificação KYC Pendente</h3>
            <p>
              Para completar suas transações, precisamos verificar sua
              identidade conforme exigido pelos regulamentos brasileiros.
            </p>
            <button id="btn-start-kyc" class="btn primary">
              Iniciar Verificação KYC
            </button>
          </div>
        </section>

        <!-- Aba da Conta -->
        <section id="account" class="tab-content">
          <h1>Minha Conta</h1>
          <p class="subtitle">Gerencie seus dados e configurações</p>

          <!-- Perfil do usuário -->
          <div class="account-card">
            <h3>Informações Pessoais</h3>

            <div class="profile-info">
              <div class="profile-item">
                <div class="profile-label">Nome:</div>
                <div class="profile-value">Usuário de Teste</div>
              </div>

              <div class="profile-item">
                <div class="profile-label">E-mail:</div>
                <div class="profile-value">usuario@teste.com</div>
              </div>

              <div class="profile-item">
                <div class="profile-label">CPF:</div>
                <div class="profile-value">123.456.789-10</div>
              </div>

              <div class="profile-item">
                <div class="profile-label">Status KYC:</div>
                <div class="profile-value">
                  <span class="badge badge-success">Verificado</span>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button class="btn disabled">Editar Perfil</button>
            </div>
          </div>

          <!-- Carteiras Salvas -->
          <div class="account-card">
            <h3>Carteiras Salvas</h3>

            <div class="saved-wallets">
              <div class="wallet-item">
                <div class="wallet-info">
                  <div class="wallet-name">Carteira Principal BTC</div>
                  <div class="wallet-address">
                    bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh
                  </div>
                </div>
                <div class="wallet-actions">
                  <button class="btn small disabled">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>

              <div class="wallet-item">
                <div class="wallet-info">
                  <div class="wallet-name">Carteira ETH</div>
                  <div class="wallet-address">
                    0x71C7656EC7ab88b098defB751B7401B5f6d8976F
                  </div>
                </div>
                <div class="wallet-actions">
                  <button class="btn small disabled">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button class="btn disabled">Adicionar Carteira</button>
            </div>
          </div>

          <!-- Preferências -->
          <div class="account-card">
            <h3>Preferências</h3>

            <div class="preferences">
              <div class="preference-item">
                <div class="preference-label">Notificações por e-mail</div>
                <label class="switch">
                  <input type="checkbox" checked disabled />
                  <span class="slider round"></span>
                </label>
              </div>

              <div class="preference-item">
                <div class="preference-label">Alertas de preço</div>
                <label class="switch">
                  <input type="checkbox" disabled />
                  <span class="slider round"></span>
                </label>
              </div>

              <div class="preference-item">
                <div class="preference-label">Newsletter semanal</div>
                <label class="switch">
                  <input type="checkbox" disabled />
                  <span class="slider round"></span>
                </label>
              </div>
            </div>

            <small>Estas preferências estarão disponíveis em breve.</small>
          </div>
        </section>
      </div>
    </main>

    <!-- Rodapé -->
    <footer>
      <div class="container">
        <div class="footer-grid">
          <div class="footer-column">
            <div class="footer-heading">FastCripto</div>
            <p>
              Sua plataforma para conversão de reais para criptomoedas de forma
              simples, rápida e segura.
            </p>
          </div>

          <div class="footer-column">
            <div class="footer-heading">Navegação</div>
            <ul class="footer-links">
              <li>
                <a href="#" class="tab-nav" data-tab="converter">Converter</a>
              </li>
              <li>
                <a href="#" class="tab-nav" data-tab="transactions"
                  >Transações</a
                >
              </li>
              <li><a href="#" class="tab-nav" data-tab="account">Conta</a></li>
            </ul>
          </div>

          <div class="footer-column">
            <div class="footer-heading">Ajuda</div>
            <ul class="footer-links">
              <li><a href="#">FAQ</a></li>
              <li><a href="#">Suporte</a></li>
              <li><a href="#">Termos de Uso</a></li>
              <li><a href="#">Política de Privacidade</a></li>
            </ul>
          </div>

          <div class="footer-column">
            <div class="footer-heading">Contato</div>
            <ul class="footer-links">
              <li>
                <a href="mailto:contato@fastcripto.com.br"
                  ><i class="bi bi-envelope"></i> contato@fastcripto.com.br</a
                >
              </li>
              <li>
                <a href="tel:+551199999999"
                  ><i class="bi bi-telephone"></i> (11) 9999-9999</a
                >
              </li>
            </ul>
          </div>
        </div>

        <div class="footer-bottom">
          <p>&copy; 2023 FastCripto. Todos os direitos reservados.</p>
        </div>
      </div>
    </footer>

    <!-- Container para notificações in-app -->
    <div id="notifications-container"></div>

    <!-- Adicionar no final do documento, antes de </body> -->
    <script>
      // Função centralizada para navegação entre etapas
      function goToStep(stepNumber) {
        console.log('Navegando para etapa:', stepNumber);
        
        // Obter referências
        const steps = document.querySelectorAll('.conversion-steps .step');
        const stepContents = document.querySelectorAll('.conversion-step');
        
        // Atualizar indicadores visuais
        steps.forEach((step, index) => {
          if (index < stepNumber) {
            step.classList.add('completed');
            step.classList.remove('active');
          } else if (index === stepNumber) {
            step.classList.add('active');
            step.classList.remove('completed');
          } else {
            step.classList.remove('active', 'completed');
          }
        });
        
        // Mostrar o conteúdo correto
        stepContents.forEach((content, index) => {
          content.classList.toggle('active', index === stepNumber);
        });
        
        // Configurações específicas para cada etapa
        if (stepNumber === 2) {
          // Preparar redes para a etapa de carteira
          updateNetworksForSelectedCrypto();
          
          // Rolar para o topo da etapa
          document.getElementById('step-pagamento')?.scrollIntoView({ behavior: 'smooth' });
        } else {
          // Rolar para a visualização da etapa atual
          stepContents[stepNumber]?.scrollIntoView({ behavior: 'smooth' });
        }
      }
      
      // Função para atualizar as redes disponíveis conforme a criptomoeda selecionada
      function updateNetworksForSelectedCrypto() {
        console.log('Atualizando redes disponíveis');
        
        // Identificar criptomoeda selecionada
        const selectedCrypto = document.querySelector('input[name="crypto-currency"]:checked')?.value || 'USDT';
        console.log('Criptomoeda selecionada:', selectedCrypto);
        
        // Obter referências às opções de rede
        const btcNetworkOption = document.querySelector('.network-btc')?.closest('.network-option');
        const ethNetworkOption = document.querySelector('.network-eth')?.closest('.network-option');
        const bscNetworkOption = document.querySelector('.network-bsc')?.closest('.network-option');
        const tronNetworkOption = document.querySelector('.network-tron')?.closest('.network-option');
        
        // Esconder todas as opções primeiro
        if (btcNetworkOption) btcNetworkOption.style.display = 'none';
        if (ethNetworkOption) ethNetworkOption.style.display = 'none';
        if (bscNetworkOption) bscNetworkOption.style.display = 'none';
        if (tronNetworkOption) tronNetworkOption.style.display = 'none';
        
        // Mostrar apenas as redes compatíveis com a criptomoeda
        switch (selectedCrypto) {
          case 'BTC':
            if (btcNetworkOption) {
              btcNetworkOption.style.display = 'flex';
              document.querySelector('.network-btc').checked = true;
            }
            break;
          case 'ETH':
            if (ethNetworkOption) {
              ethNetworkOption.style.display = 'flex';
              document.querySelector('.network-eth').checked = true;
            }
            break;
          case 'USDT':
            if (tronNetworkOption) {
              tronNetworkOption.style.display = 'flex';
              document.querySelector('.network-tron').checked = true;
            }
            break;
          default:
            // Mostrar todas as redes para outras criptomoedas
            if (btcNetworkOption) btcNetworkOption.style.display = 'flex';
            if (ethNetworkOption) ethNetworkOption.style.display = 'flex';
            if (bscNetworkOption) bscNetworkOption.style.display = 'flex';
            if (tronNetworkOption) tronNetworkOption.style.display = 'flex';
        }
        
        // Atualizar mensagem informativa se for USDT com rede TRON
        if (selectedCrypto === 'USDT' && tronNetworkOption) {
          const networkGroup = tronNetworkOption.closest('.form-group');
          let existingInfo = networkGroup.querySelector('.network-info-message');
          
          if (!existingInfo) {
            const infoMessage = document.createElement('div');
            infoMessage.className = 'network-info-message alert alert-info mt-2';
            infoMessage.style.fontSize = '0.9rem';
            infoMessage.style.padding = '10px';
            infoMessage.style.borderRadius = '6px';
            infoMessage.style.backgroundColor = '#e7f5ff';
            infoMessage.style.borderLeft = '4px solid #5d5fef';
            infoMessage.innerHTML = '<i class="bi bi-info-circle-fill me-2"></i><strong>Importante:</strong> Para USDT, utilizamos exclusivamente a rede TRON (TRC20) por sua segurança e baixas taxas.';
            
            networkGroup.appendChild(infoMessage);
          }
        }
      }
      
      // Função para validar o endereço da carteira
      function validateWalletAddress() {
        const walletInput = document.getElementById('wallet-address');
        if (!walletInput) return false;
        
        const walletValue = walletInput.value.trim();
        if (!walletValue) {
          alert('Por favor, informe o endereço da carteira.');
          return false;
        }
        
        // Obter a criptomoeda e rede selecionadas
        const selectedCrypto = document.querySelector('input[name="crypto-currency"]:checked')?.value;
        const selectedNetwork = document.querySelector('input[name="network"]:checked')?.value;
        
        if (!selectedCrypto || !selectedNetwork) {
          alert('Por favor, selecione a criptomoeda e a rede.');
          return false;
        }
        
        // Validações específicas por tipo de criptomoeda/rede
        let isValid = true;
        let validationMessage = '';
        
        switch (true) {
          case selectedCrypto === 'BTC':
            // Validação de carteira Bitcoin (começa com 1, 3, ou bc1)
            if (!/^(1|3|bc1)[a-zA-Z0-9]{25,34}$/.test(walletValue)) {
              validationMessage = 'Endereço de Bitcoin inválido';
              isValid = false;
            }
            break;
            
          case selectedCrypto === 'ETH':
            // Validação de carteira Ethereum (começa com 0x)
            if (!/^0x[a-fA-F0-9]{40}$/.test(walletValue)) {
              validationMessage = 'Endereço de Ethereum inválido';
              isValid = false;
            }
            break;
            
          case selectedCrypto === 'USDT' && selectedNetwork === 'ETH':
            if (!/^0x[a-fA-F0-9]{40}$/.test(walletValue)) {
              validationMessage = 'Endereço de USDT na rede Ethereum inválido';
              isValid = false;
            }
            break;
            
          case selectedCrypto === 'USDT' && selectedNetwork === 'BSC':
            if (!/^0x[a-fA-F0-9]{40}$/.test(walletValue)) {
              validationMessage = 'Endereço de USDT na rede BSC inválido';
              isValid = false;
            }
            break;
            
          case selectedCrypto === 'USDT' && selectedNetwork === 'TRON':
            if (!/^T[A-Za-z1-9]{33}$/.test(walletValue)) {
              validationMessage = 'Endereço de USDT na rede TRON inválido (deve começar com T e ter 34 caracteres)';
              isValid = false;
            }
            break;
            
          default:
            // Para outros casos, verificar apenas o comprimento
            if (walletValue.length < 20) {
              validationMessage = 'Endereço de carteira muito curto';
              isValid = false;
            }
        }
        
        if (!isValid) {
          alert(validationMessage);
          walletInput.focus();
          return false;
        }
        
        return true;
      }
      
      // Função para calcular a conversão
      function calculateConversion() {
        console.log('Calculando conversão...');
        
        // Obter valor em Reais
        const brlAmountInput = document.getElementById('brl-amount');
        if (!brlAmountInput) {
          console.error('Elemento do valor em BRL não encontrado');
          return;
        }
        
        const brlAmount = parseFloat(brlAmountInput.value);
        
        // Validar o valor
        if (!brlAmount || isNaN(brlAmount)) {
          alert('Por favor, informe um valor válido em reais.');
          brlAmountInput.focus();
          return;
        }
        
        if (brlAmount < 100) {
          alert('O valor mínimo é R$ 100,00');
          brlAmountInput.focus();
          return;
        }
        
        // Obter criptomoeda selecionada
        const selectedCrypto = document.querySelector('input[name="crypto-currency"]:checked');
        if (!selectedCrypto) {
          alert('Selecione uma criptomoeda');
          return;
        }
        
        const cryptoValue = selectedCrypto.value;
        console.log(`Criptomoeda selecionada: ${cryptoValue}`);
        
        try {
          // Taxas
          const iofRate = 0.0038; // 0.38%
          const serviceRate = 0.06; // 6%
          
          // Cotações
          const rates = {
            BTC: 340000,
            ETH: 17500,
            USDT: 5.30
          };
          
          // Taxas de rede (em cripto)
          const networkFees = {
            BTC: 0.0001,
            ETH: 0.005,
            USDT: 1
          };
          
          const rate = rates[cryptoValue];
          const iofAmount = brlAmount * iofRate;
          const serviceAmount = brlAmount * serviceRate;
          const netAmount = brlAmount - iofAmount - serviceAmount;
          const cryptoAmount = netAmount / rate;
          const networkFee = networkFees[cryptoValue];
          const finalCryptoAmount = cryptoAmount - networkFee;
          
          if (finalCryptoAmount <= 0) {
            alert('Valor muito baixo para cobrir as taxas. Aumente o valor da transação.');
            return;
          }
          
          // Formatar valores para exibição
          const formatCurrency = (value) => {
            return new Intl.NumberFormat('pt-BR', {
              style: 'currency',
              currency: 'BRL'
            }).format(value);
          };
          
          // Mostrar resultado
          const resultElement = document.getElementById('conversion-result');
          if (resultElement) {
            resultElement.style.display = 'block';
            
            // Preencher detalhes
            document.getElementById('result-brl-amount').textContent = formatCurrency(brlAmount);
            document.getElementById('result-iof').textContent = formatCurrency(iofAmount);
            document.getElementById('result-service-fee').textContent = formatCurrency(serviceAmount);
            
            // Mostrar taxa de rede de forma apropriada
            let networkFeeText;
            if (cryptoValue === 'USDT') {
              networkFeeText = `${networkFee} ${cryptoValue} (aprox. ${formatCurrency(networkFee * rate)})`;
            } else {
              networkFeeText = `${networkFee} ${cryptoValue} (aprox. ${formatCurrency(networkFee * rate)})`;
            }
            document.getElementById('result-network-fee').textContent = networkFeeText;
            
            document.getElementById('result-net-amount').textContent = formatCurrency(netAmount);
            document.getElementById('result-rate').textContent = formatCurrency(rate);
            
            // Formatar o valor da cripto conforme o tipo
            let decimals = cryptoValue === 'BTC' ? 8 : (cryptoValue === 'USDT' ? 2 : 6);
            document.getElementById('result-crypto-amount').textContent = `${finalCryptoAmount.toFixed(decimals)} ${cryptoValue}`;
          }
          
          // Armazenar a conversão atual para uso posterior
          window.currentConversion = {
            brlAmount,
            iofAmount,
            serviceAmount,
            netAmount,
            cryptoAmount,
            finalCryptoAmount,
            rate,
            currency: cryptoValue,
            networkFee
          };
          
          // Avançar para a próxima etapa
          goToStep(1);
          
        } catch (error) {
          console.error('Erro ao calcular conversão:', error);
          alert('Ocorreu um erro ao calcular a conversão. Por favor, tente novamente.');
        }
      }
      
      // Inicializar quando o DOM estiver pronto
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM carregado! Inicializando sistema...');
        
        // Configuração do botão para calcular conversão
        const calculateButton = document.getElementById('btn-calculate');
        if (calculateButton) {
          calculateButton.addEventListener('click', calculateConversion);
        }
        
        // Botão de voltar para a etapa 1
        const btnBackToStep1 = document.getElementById('btn-back-to-step1');
        if (btnBackToStep1) {
          btnBackToStep1.addEventListener('click', function() {
            goToStep(0);
          });
        }
        
        // Botão para prosseguir para a etapa 3
        const btnProceedToStep3 = document.getElementById('btn-proceed-to-step3');
        if (btnProceedToStep3) {
          btnProceedToStep3.addEventListener('click', function() {
            console.log('Botão Prosseguir clicado!');
            goToStep(2);
          });
        }
        
        // Botão para voltar para a etapa 2
        const btnBackToStep2 = document.getElementById('btn-back-to-step2');
        if (btnBackToStep2) {
          btnBackToStep2.addEventListener('click', function() {
            goToStep(1);
          });
        }
        
        // Formulário da carteira (etapa 3)
        const walletForm = document.getElementById('wallet-form');
        if (walletForm) {
          walletForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validar o endereço da carteira
            if (!validateWalletAddress()) {
              return;
            }
            
            // Verificar se a confirmação está marcada
            const walletConfirm = document.getElementById('wallet-confirm').checked;
            if (!walletConfirm) {
              alert('Por favor, confirme que o endereço está correto.');
              return;
            }
            
            // Adicionar o endereço da carteira à conversão atual
            if (window.currentConversion) {
              window.currentConversion.walletAddress = document.getElementById('wallet-address').value.trim();
              window.currentConversion.network = document.querySelector('input[name="network"]:checked').value;
            }
            
            // Simular processamento
            const btnCompleteTransaction = document.getElementById('btn-complete-transaction');
            if (btnCompleteTransaction) {
              btnCompleteTransaction.disabled = true;
              btnCompleteTransaction.innerHTML = '<i class="bi bi-hourglass-split"></i> Processando...';
            }
            
            // Verificar se precisa completar KYC antes
            setTimeout(() => {
              // Abrir o modal KYC
              if (typeof showKYCModal === 'function') {
                showKYCModal(function() {
                  // Callback de sucesso após KYC
                  alert('Transação iniciada com sucesso! Você receberá um e-mail com os detalhes.');
                  
                  // Adicionar a transação ao histórico
                  if (window.currentConversion) {
                    const transaction = {
                      id: `TX${Date.now()}`,
                      status: 'processing',
                      createdAt: new Date().toISOString(),
                      ...window.currentConversion
                    };
                    
                    // Usar função para adicionar ao histórico se existir
                    if (typeof addTransactionToHistory === 'function') {
                      addTransactionToHistory(transaction);
                    } else {
                      console.log('Transação criada:', transaction);
                    }
                  }
                  
                  // Voltar para a primeira etapa
                  const converterTab = document.querySelector('.tab-nav[data-tab="converter"]');
                  if (converterTab) converterTab.click();
                  
                  // Resetar formulário
                  document.getElementById('brl-amount').value = '';
                  if (btnCompleteTransaction) {
                    btnCompleteTransaction.disabled = false;
                    btnCompleteTransaction.innerHTML = '<i class="bi bi-check-circle"></i> Completar Transação';
                  }
                });
              } else {
                alert('Não foi possível iniciar a verificação KYC. Por favor, tente novamente mais tarde.');
                if (btnCompleteTransaction) {
                  btnCompleteTransaction.disabled = false;
                  btnCompleteTransaction.innerHTML = '<i class="bi bi-check-circle"></i> Completar Transação';
                }
              }
            }, 1500);
          });
        }
        
        // Botão KYC principal
        const mainKycBtn = document.getElementById('mainKycBtn');
        if (mainKycBtn) {
          mainKycBtn.addEventListener('click', function() {
            // Verificar se temos a função showKYCModal disponível
            if (typeof showKYCModal === 'function') {
              showKYCModal(function() {
                // Callback de sucesso
                alert('Verificação KYC concluída com sucesso! Suas transações serão processadas em breve.');
                
                // Navegar para a página de transações
                const transactionsTab = document.querySelector('.tab-nav[data-tab="transactions"]');
                if (transactionsTab) transactionsTab.click();
              });
            } else {
              console.error('Função showKYCModal não encontrada');
              alert('Funcionalidade em desenvolvimento. Por favor, tente novamente mais tarde.');
            }
          });
        }
        
        // Botão para verificar o endereço da carteira
        const verifyButton = document.querySelector('button[title="Verificar endereço"]');
        if (verifyButton) {
          verifyButton.addEventListener('click', function() {
            validateWalletAddress();
          });
        }
        
        // Botão para colar da área de transferência
        const clipboardButton = document.querySelector('button[title="Colar da área de transferência"]');
        if (clipboardButton) {
          clipboardButton.addEventListener('click', async function() {
            try {
              const text = await navigator.clipboard.readText();
              const walletInput = document.getElementById('wallet-address');
              if (walletInput && text) {
                walletInput.value = text;
                // Disparar validação
                validateWalletAddress();
              }
            } catch (err) {
              console.error('Falha ao ler da área de transferência:', err);
              alert('Não foi possível acessar a área de transferência. Por favor, cole o endereço manualmente.');
            }
          });
        }
        
        // Destacar visualmente redes ao selecionar
        const networkOptions = document.querySelectorAll('.network-option');
        networkOptions.forEach(option => {
          const radioInput = option.querySelector('input[type="radio"]');
          
          // Estado inicial
          if (radioInput.checked) {
            option.style.borderColor = '#5d5fef';
            option.style.backgroundColor = 'rgba(93, 95, 239, 0.05)';
          }
          
          // Mudança de estado
          radioInput.addEventListener('change', function() {
            // Resetar todos
            networkOptions.forEach(opt => {
              opt.style.borderColor = '#e9ecef';
              opt.style.backgroundColor = 'transparent';
            });
            
            // Destacar o selecionado
            if (this.checked) {
              option.style.borderColor = '#5d5fef';
              option.style.backgroundColor = 'rgba(93, 95, 239, 0.05)';
            }
          });
        });
        
        // Destacar opções de criptomoeda quando selecionadas
        const cryptoOptions = document.querySelectorAll('.crypto-option');
        cryptoOptions.forEach(option => {
          const radioInput = option.querySelector('input[type="radio"]');
          
          // Estado inicial
          if (radioInput.checked) {
            option.style.borderColor = '#5d5fef';
            option.style.backgroundColor = 'rgba(93, 95, 239, 0.05)';
          }
          
          // Mudança de estado
          radioInput.addEventListener('change', function() {
            // Resetar todos
            cryptoOptions.forEach(opt => {
              opt.style.borderColor = '#e9ecef';
              opt.style.backgroundColor = 'transparent';
            });
            
            // Destacar o selecionado
            if (this.checked) {
              option.style.borderColor = '#5d5fef';
              option.style.backgroundColor = 'rgba(93, 95, 239, 0.05)';
            }
          });
        });
      });
    </script>
  </body>
</html>
